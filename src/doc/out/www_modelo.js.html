<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: www/modelo.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: www/modelo.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>export class Modelo{
	constructor(){
		this.baseDatos
		this.lista = []
		this.callbacks = [] 
		this.idb()
	}	
	registrar(callback){
		this.callbacks.push(callback)
	}
	avisar(){
		for(let callback of this.callbacks)
		callback()
	}
	/**
	 * Devuelve los registros que haya en la base de datos y luego llama a los callbacks
	 **/
	obtenerRegistro(){
		const peticion= this.baseDatos.transaction('tablaAstros', 'readonly').objectStore('tablaAstros').getAll();
		
		peticion.onsuccess = () => {
			this.lista = peticion.result;
			this.avisar()
		}
		peticion.onerror = () => {
			console.error("No se ha podido conectar")
		}
	}
	/** 
	 * Inserta un registro en la base de datos
	*/
	insertar(nombre, diametro, descripcion, fecha, tipo, file){

		if (file)
		{
			let reader = new FileReader()
			reader.readAsDataURL(file)
			reader.onload = () =>
			{
				let obj={
					nombre: nombre,
					diametro: diametro,
					descripcion: descripcion,
					fecha: fecha,
					tipo: tipo, 
					file : reader.result
				}
				const almacenar=this.baseDatos.transaction('tablaAstros','readwrite').objectStore('tablaAstros').add(obj);
	
				almacenar.onsuccess=()=>{
					this.obtenerRegistro()
				}
					
			}
		}
		else
		{
			let obj={
				nombre: nombre,
				diametro: diametro,
				descripcion: descripcion,
				fecha: fecha,
				tipo: tipo, 
				file : null
			}
			const almacenar=this.baseDatos.transaction('tablaAstros','readwrite').objectStore('tablaAstros').add(obj);

			almacenar.onsuccess=()=>{
				this.obtenerRegistro()
			}
			
		}
	

	}
	/**
	 * Conecta a la base de datos
	 */
	idb(){

		const bd=window.indexedDB
		if(window.indexedDB){
		
			const respuesta=indexedDB.open("Astros",1);
		
			respuesta.onsuccess=(event)=>{
				
				this.baseDatos=event.target.result
				this.obtenerRegistro()
			}
			respuesta.onerror=()=>{
				console.log('ERROR');
			}
			respuesta.onupgradeneeded=(evt)=>{
				
				this.baseDatos=evt.target.result
				this.baseDatos.createObjectStore('tablaAstros',{keyPath:'id', autoIncrement:true})
				
			}
		}	
		
	}
	/* Borra los datos de la tabla astros */
	borrar(id){
		console.log(id)
		const request = this.baseDatos.transaction('tablaAstros','readwrite').objectStore("tablaAstros").delete(id)

		request.onsuccess = () =>{
			this.obtenerRegistro();
		}
	}

	/**
	 * Retorna la lista de datos del modelo
	 * @returns this.lista
	 */
	getDatos(){
		return this.lista
	}
	
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Controlador.html">Controlador</a></li><li><a href="Vista_Vista.html">Vista</a></li><li><a href="VistaAltas_VistaAltas.html">VistaAltas</a></li><li><a href="VistaHeader_VistaHeader.html">VistaHeader</a></li><li><a href="VistaInicio_VistaInicio.html">VistaInicio</a></li><li><a href="VistaListar_VistaListar.html">VistaListar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Fri Jan 27 2023 10:30:52 GMT+0100 (hora est√°ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
